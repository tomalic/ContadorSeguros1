<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Recuento Seguros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4a7c2b" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --verde-claro: #a6d96a;
      --verde-oscuro: #4a7c2b;
      --naranja-claro: #ffd08a;
      --naranja-oscuro: #d98b00;
      --rojo: #e4573d;
      --gris-fondo: #f5f5f5;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 16px;
      background: var(--gris-fondo);
      display: flex;
      justify-content: center;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 480px;
      background: #fff;
      border-radius: 24px;
      padding: 16px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.12);
    }

    .title {
      text-align: center;
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 18px;
      border: 3px solid black;
      border-radius: 999px;
      padding: 10px;
    }

    /* ---- BOTÓN PRINCIPAL PRESENTADO ---- */
    .presentado-container {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 24px;
    }

    .presentado-btn {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #c8f28e, var(--verde-claro));
      border: 5px solid var(--verde-oscuro);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      cursor: pointer;
      box-shadow: 0 5px 12px rgba(0,0,0,0.18);
      transition: transform 0.1s ease;
    }

    .presentado-btn:active {
      transform: scale(0.95);
    }

    .presentado-btn .count {
      font-size: 2.4rem;
      font-weight: 700;
    }

    .presentado-btn .label {
      font-size: 1.1rem;
      margin-top: 4px;
    }

    /* ---- RESTO DE BOTONES ---- */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .button-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .circle-btn {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--naranja-claro), var(--naranja-oscuro));
      border: 4px solid var(--naranja-oscuro);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    .circle-btn:active { transform: scale(0.95); }

    .circle-btn .count {
      font-size: 2rem;
      font-weight: 600;
    }

    .label { font-size: 0.85rem; }

    /* ---- BOTONES DESHACER Y BORRAR ---- */
    .actions-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 28px;
    }

    .undo-btn, .clear-btn {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    .undo-btn {
      background: radial-gradient(circle at 30% 30%, #c8f28e, var(--verde-claro));
      border: 4px solid var(--verde-oscuro);
    }

    .undo-arrow { font-size: 2.4rem; }

    .clear-btn {
      background: radial-gradient(circle at 30% 30%, #ff8b6b, var(--rojo));
      border: 4px solid #a12a1a;
      color: white;
    }

    /* ---- TOTALES ---- */
    .totals {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
    }

    .total-box {
      min-width: 120px;
      padding: 8px;
      font-size: 1.2rem;
      text-align: center;
      font-weight: 700;
      border-radius: 999px;
      border: 3px solid black;
    }

    #objetivo-box.ok { color: #0a7c0a; border-color: #0a7c0a; }
    #objetivo-box.bad { color: #b00020; border-color: #b00020; }
  </style>
</head>

<body>
  <div class="app">
    <div class="title">RECUENTO SEGUROS</div>

    <!-- BOTÓN PRESENTADO -->
    <div class="presentado-container">
      <div class="presentado-btn" id="btn-presentado">
        <span class="count" id="count-presentado">0</span>
        <span class="label">Presentado</span>
      </div>
    </div>

    <!-- RESTO DE BOTONES -->
    <div class="grid" id="buttons-grid"></div>

    <div class="actions-row">
      <button class="undo-btn" id="undo-btn">
        <div class="undo-arrow">⬅️</div>
        <div>Deshacer</div>
      </button>

      <button class="clear-btn" id="clear-btn">Borrar todo</button>
    </div>

    <div class="totals">
      <div class="total-row">
        <div>Total unidades</div>
        <div class="total-box" id="total-unidades-box">0</div>
      </div>

      <div class="total-row">
        <div>Presentados</div>
        <div class="total-box" id="presentados-box">0</div>
      </div>

      <div class="total-row">
        <div>Objetivo</div>
        <div class="total-box" id="objetivo-box">+0</div>
      </div>
    </div>
  </div>

<script>
/* ---- CONFIGURACIÓN --- */

const buttons = [
  { key: "noLoQuiere", label: "No lo quiere" },
  { key: "ticket", label: "Ticket" },
  { key: "extranjero", label: "Extranjero" },
  { key: "rescicion", label: "Rescisión" },
  { key: "abono", label: "Abono" },
  { key: "factura", label: "Factura" },
  { key: "regalo", label: "Regalo" }
];

const UNITS_KEYS = ["presentado", ...buttons.map(b => b.key)];
const PRESENTED_KEYS = ["presentado"];
const STORAGE_KEY = "segurosCounter_v2";

let state = { counts: {}, history: [] };

function initState() {
  state.counts = { presentado: 0 };
  buttons.forEach(b => state.counts[b.key] = 0);
  state.history = [];
}

function loadState() {
  const raw = localStorage.getItem(STORAGE_KEY);
  if (!raw) return initState();
  try {
    const parsed = JSON.parse(raw);
    initState();
    Object.keys(state.counts).forEach(k => {
      if (parsed.counts?.[k] >= 0) state.counts[k] = parsed.counts[k];
    });
    state.history = parsed.history || [];
  } catch {
    initState();
  }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ---- CÁLCULOS --- */

function computeTotals() {
  let totalUnits = 0;
  let presented = 0;

  UNITS_KEYS.forEach(k => totalUnits += state.counts[k] || 0);
  PRESENTED_KEYS.forEach(k => presented += state.counts[k] || 0);

  const objetivo = 2 * presented - totalUnits;
  return { totalUnits, presented, objetivo };
}

/* ---- RENDER --- */

function renderButtons() {
  const grid = document.getElementById("buttons-grid");
  grid.innerHTML = "";

  buttons.forEach(btn => {
    const card = document.createElement("div");
    card.className = "button-card";

    const circle = document.createElement("div");
    circle.className = "circle-btn";
    circle.dataset.key = btn.key;

    const count = document.createElement("span");
    count.className = "count";
    count.textContent = state.counts[btn.key];

    circle.appendChild(count);
    circle.onclick = () => increment(btn.key);

    const label = document.createElement("div");
    label.className = "label";
    label.textContent = btn.label;

    card.appendChild(circle);
    card.appendChild(label);
    grid.appendChild(card);
  });
}

function renderTotals() {
  const { totalUnits, presented, objetivo } = computeTotals();

  document.getElementById("total-unidades-box").textContent = totalUnits;
  document.getElementById("presentados-box").textContent = presented;

  const objBox = document.getElementById("objetivo-box");
  objBox.textContent = (objetivo >= 0 ? "+" : "") + objetivo;
  objBox.classList.toggle("ok", objetivo >= 0);
  objBox.classList.toggle("bad", objetivo < 0);

  document.getElementById("count-presentado").textContent =
    state.counts.presentado;
}

function render() {
  renderTotals();
  buttons.forEach(btn => {
    const el = document.querySelector(`.circle-btn[data-key="${btn.key}"] .count`);
    if (el) el.textContent = state.counts[btn.key];
  });
}

/* ---- ACCIONES --- */

function increment(key) {
  state.counts[key]++;
  state.history.push(key);
  saveState();
  render();
}

function undoLast() {
  if (!state.history.length) return;
  const key = state.history.pop();
  if (state.counts[key] > 0) state.counts[key]--;
  saveState();
  render();
}

function clearAll() {
  if (!confirm("¿Seguro que quieres borrar todos los datos?")) return;
  initState();
  saveState();
  render();
}

/* ---- ARRANQUE --- */

function main() {
  loadState();
  renderButtons();
  render();

  document.getElementById("btn-presentado").onclick = () => increment("presentado");
  document.getElementById("undo-btn").onclick = undoLast;
  document.getElementById("clear-btn").onclick = clearAll;
}

main();
</script>

</body>
</html>
